name: Keep Render Service Alive

on:
  schedule:
    # Run every 10 minutes (Render spins down after 15 minutes of inactivity)
    - cron: '*/10 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Health Endpoint
        run: |
          # Get the Render service URL from repository variables
          # You'll need to set RENDER_SERVICE_URL in GitHub repository secrets
          SERVICE_URL="${{ secrets.RENDER_SERVICE_URL || 'https://quotla-ml.onrender.com' }}"

          echo "Pinging $SERVICE_URL/health..."

          # Ping the health endpoint with timeout
          response=$(curl -s -o /dev/null -w "%{http_code}" --max-time 60 "$SERVICE_URL/health")

          if [ "$response" = "200" ]; then
            echo "✅ Service is alive (HTTP $response)"
          else
            echo "⚠️ Service returned HTTP $response"
            # Don't fail the workflow - service might be starting up
          fi

      - name: Log Timestamp
        run: echo "Last ping at $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
